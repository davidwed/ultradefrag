<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rev="made" href="mailto:dmitriar + at + gmail + dot + com" />
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="description" content="UltraDefrag Design Notes" />
<meta name="keywords" content="UltraDefrag, Ultra Defragmenter, defragmentation,Open Source disk defragmenter, defragger, boot time defragmentation, boot time defragger, Developer Info, Design Notes" />
<meta name="revisit-after" content="30 days" />
<meta name="robots" content="index, follow, noarchive" />
<link rel="shortcut icon" href="udefrag.ico" />
<link rel="stylesheet" type="text/css" href="udefrag.css" />
<title>UltraDefrag - powerful Open Source disk defragmenter - Design Notes</title>
<style type="text/css">
<!--
TD {text-align:left}
-->
</style>
</head>
<body>
<center><hr /><font size="+1">U</font>ltra <font size="+1">D</font>efragmenter
<font size="+1">V</font>ersion <font size="+1">1.3.3</font><br />
<br />Copyright (C) 2007,2008 <a href="mailto:dmitriar + at + gmail + dot + com">Dmitri Arkhangelski</a>, 
<a href="mailto:zippy1981 + at + gmail + dot + com">Justin Dearing</a>.<br />
<hr />
<p id="links">
<a href="http://ultradefrag.sourceforge.net/index.html">[Homepage]</a>
<a href="http://sourceforge.net/project/showfiles.php?group_id=199532">[Download]</a>
<a href="http://ultradefrag.sourceforge.net/manual.html">[User Manual]</a>
<a href="http://ultradefrag.sourceforge.net/faq.html">[FAQ]</a><br />
<a href="http://ultradefrag.sourceforge.net/developer_info.html">[Development]</a>
<a href="http://ultradefrag.sourceforge.net/art.html">[Art]</a>
<a href="http://ultradefrag.sourceforge.net/authors_about.html">[About the Authors]</a>
<a href="http://ultradefrag.sourceforge.net/links.html">[Links]</a>
</p>
<hr />
<h3 style="font-variant: small-caps">Design Notes</h3>
</center>
<p>The Ultra Defragmenter contains few modules that are separated to five levels 
as shown on a picture below.</p>
<center><img src="images/udscheme.png" width="308" height="323" border="0" 
alt="Application Scheme" /></center>
<p>At the bottom level we have the kernel mode driver named ultradfg.sys. As described in
our <a href="manual.html">User Manual</a> this is the best solution for the disk 
defragmentation software. Though we have still a problem with driver loading on x64 
Vista, driver gives us an interesting features and advantages over other defraggers.
</p>
<p>The second level contains two different dynamically linked libraries.
</p>
<p>ZenWINX is a common set of functions that most programs needs. Boot time defragger 
can't use win32 environment, it should use only ntdll.dll, but this library doesn't 
contain many important things like keyboard related procedures (gets, getch, kbhit), 
printf implementation and others. ZenWINX was created to resolve this problem.
</p>
<p>On the other hand, the udefrag.dll library is just a thin level between the driver and
user interfaces. It provides more simpler API than driver have. This module can import 
symbols from ntdll.dll (and other native dll's like zenwinx) only, because it is used 
by native (boot time) application.
</p>
<p>Over the described modules are user interfaces located. They are well documented in our 
manual. I wrote them in pure C language because I would like to run UltraDefrag on 
old machines without any additional packages installed. Windows distribution doesn't 
contain any modern scripting languages packages (Python, Perl etc.), so C is better 
choice here.
</p>
<p>As you can see, gui application uses some external software. The report converter
produce html reports from a simple text file generated by driver. This converter is written 
in Lua, because this language has much better support for string manipulations than C or 
C++ have, and it's a very small package that can be included in UltraDefrag binaries 
without any problems.
</p>
<p>Other programs that are used by gui are a text editor (that must have Unicode support) 
and a web browser. The first is needed to edit program's settings. It's better to use an 
external text editor than write a specialized one. Less code we have less bugs we have.
Web browser is a good program to display either User Manual and other docs or to show 
the general information about the program. Note that text files can be translated without 
problems, but compiled application's translation is much difficult.
</p>
<p>The highest level of the Ultra Defragmenter I wrote in JavaScript language, because it 
is very simple, can be embedded in web pages and has good (though primitive enough) 
support for strings processing.
</p>
<p>Of course, we have not discussed yet our installer and scheduler. NSIS gives us an 
ability to have both installer and portable package in the same file. This language is 
very powerful and we don't need to use something else at this moment.
</p>
<p>Scheduler is an additional application that is much easier to use than built-in task
scheduler interface. It requires .NET Framework installed because C# was a good choice to 
implement this optional component. In any case, we have now a good prototype for the 
scheduler. If you wish, rewrite it in C or maybe in Assembler.
</p>
<p>I don't plan to write some additional interfaces, p.a. one with skins, another 
implemented in popular Python language and so on. But if you would like to have 
experiments in this area you are welcome!
</p>
<hr />
<table align="right">
<tbody>
<tr align="right">
<td><a href="http://www.lua.org/"><img src="images/powered_by_lua.png" alt="Powered by Lua" border="0" height="31" width="124" /></a></td>
<td><a href="http://validator.w3.org/check/referer"><img src="images/valid-xhtml10.png" alt="Valid XHTML 1.0!" border="0" height="31" width="88" /></a></td>
<td><a href="http://sourceforge.net"><img src="http://sourceforge.net/sflogo.php?group_id=199532&amp;type=1" alt="SourceForge.net Logo" border="0" height="31" width="88" /></a></td>
</tr>
</tbody>
</table>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-2897964-4");
pageTracker._initData();
pageTracker._trackPageview();
</script></body></html>