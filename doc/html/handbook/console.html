<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>Chapter 3. Console interface</title>
  <link rel="stylesheet" href="kde-default.css" type="text/css" />
  <link rel="stylesheet" href="udefrag.css" type="text/css" />
  <meta name="description" content="Ultra Defragmenter is a powerful Open Source defragmentation tool for Windows NT." />
  <meta name="keywords" content="UltraDefrag, Ultra Defragmenter, defragmentation, Open Source disk defragmenter, defragger, boot time defragmentation, boot time defragger, handbook, user manual, console interface" />
  <link rel="start" href="index.html" title="Ultra Defragmenter Handbook" />
  <link rel="prev" href="installation.html" title="Chapter 2. Installation" />
  <link rel="next" href="gui.html" title="Chapter 4. Graphical interface" />
</head>

<body bgcolor="white" text="black" alink="#0000ff" link="#0000ff" vlink="#840084">

<div style="background-image: url(top-middle.png); width: 100%; height: 131px;">
	<div style="position: absolute; right: 0px;">
		<img src="top-right-konqueror.png" style="margin: 0px;" alt="" />
	</div>

	<div style="position: absolute; top: 25px; right: 100px; text-align: right; font-size: xx-large; font-weight: bold; text-shadow: #fff 0px 0px 5px; color: #444;">
	Console interface</div>
</div>

<div style="margin-top: 20px; background-color: white; color: black; margin-left: 20px; margin-right: 20px;">
	<div style="position: absolute; left: 20px;"><a accesskey="p" href="installation.html">Prev</a></div>

	<div style="position: absolute; right: 20px;"><a accesskey="n" href="gui.html">Next</a></div>

	<div class="navCenter">&nbsp;</div>
</div>

<div class="chapter" lang="en">
	<div class="titlepage">
		<div><div>
				<h2 class="title">Chapter 3. Console interface</h2>
		</div></div>
	</div>

	<div class="toc">
		<p><b>Table of Contents</b></p>
		<dl>
			<dt><span class="sect1"><a href="console.html#overview">Overview</a></span></dt>
			<dt><span class="sect1"><a href="console.html#switches">Command line switches</a></span></dt>
			<dt><span class="sect1"><a href="console.html#env">Accepted environment variables</a></span></dt>
			<dt><span class="sect1"><a href="console.html#ctxhandler">Context menu handler</a></span></dt>
			<dt><span class="sect1"><a href="console.html#examples">Example batch scripts</a></span></dt>
		</dl>
	</div>
	
	<div class="sect1" lang="en">
		<div class="titlepage">
			<div><div>
				<h2 class="title" style="clear: both"><a name="overview"></a>
				Overview</h2>
			</div></div>
		</div>
		<p>The console application is called udefrag.exe. It
		is placed in system32 directory by the installer. Therefore you can
		call it from the command line or run box.</p>

<center>
<pre width="55pt" style="border: 2px solid; background-color: black; font-size: 12pt;">
<div align="center" style="background-color: blue; color: white">Command prompt</div><div align="left" style="color: white">
Microsoft Windows XP [5.1.2600]
(C) Microsoft Corporation, 1985-2001.

C:\>udefrag -a c:</div><div align="left" style="color: #00FF00">UltraDefrag v3.1.0 console interface
Copyright (c) Dmitri Arkhangelski, 2007-2009.


Volume information:

  Volume size                  = 3.92 Gb
  Free space                   = 917.56 Mb
  
  Total number of files        = 14688
  Number of fragmented files   = 126
  Fragments per file           = 1.21
</div><div align="left" style="color: white">
C:\>_
</div>
</pre>
<i>Console Application after a successful analyze run.</i>
</center>
	</div>

	<div class="sect1" lang="en">
		<div class="titlepage">
			<div><div>
				<h2 class="title" style="clear: both"><a name="switches"></a>
				Command line switches</h2>
			</div></div>
		</div>
		<p>The command line version takes a drive letter and one of the following switches:</p>
		<table border="1" style="border-collapse: collapse;" cellPadding="5pt" align="center"><tbody>
			<tr>
				<td class="graycode">-a</td>
				<td>analyze the drive specified on the command line</td>
			</tr>
			<tr>
				<td class="graycode">-o</td>
				<td>optimize file space by moving all files to the begining of the drive</td>
			</tr>
			<tr>
				<td class="graycode">-l</td>
				<td>list volumes available for defragmentation except removable</td>
			</tr>
			<tr>
				<td class="graycode">-la</td>
				<td>list all volumes available for defragmentation</td>
			</tr>
			<tr>
				<td class="graycode">-b</td>
				<td>use default color scheme (usually black/white)</td>
			</tr>
			<tr>
				<td class="graycode">-?</td>
				<td>displays the usage message (-h has the same effect)</td>
			</tr>
		</tbody></table>
		<p>
		Specifying just the drive letter will cause <span class="application">UltraDefrag</span>
		to defragment the drive. When the operation finishes or you stop the program with a Ctrl+C, 
		the program will display the results to the console. If you abort the operation with 
		Ctrl+C or close the shell window, <span class="application">UltraDefrag</span> will exit 
		safely without destroying any data.
		</p>
<p>To get list of available volumes type <span class="code">udefrag -l</span>. 
Each line of output contains volume letter, type of file system, total size and percent 
of free space. Here is an example:
<center>
<pre width="55pt" style="border: 2px solid; background-color: black; font-size: 12pt;">
<div align="center" style="background-color: blue; color: white">Command prompt</div><div align="left" style="color: white">
Microsoft Windows XP [5.1.2600]
(C) Microsoft Corporation, 1985-2001.

C:\>udefrag -l</div><div align="left" style="color: #00FF00">UltraDefrag v3.1.0 console interface
Copyright (c) Dmitri Arkhangelski, 2007-2009.</div><div align="left" style="color: #FFFF00">
Volumes available for defragmentation:

C:      NTFS      3.92 Gb        6 %
D:      NTFS      9.42 Gb        3 %
E:     FAT32     59.30 Gb        5 %
</div><div align="left" style="color: white">
C:\>_
</div>
</pre>
</p>
	</div>

	<div class="sect1" lang="en">
		<div class="titlepage">
			<div><div>
				<h2 class="title" style="clear: both"><a name="env"></a>
				Accepted environment variables</h2>
			</div></div>
		</div>
		<p>To set defragmenter options you should use the 
		<a href="http://en.wikipedia.org/wiki/Environment_variable">Environment Variables</a>. 
		To set each of them you can simply type in command line <span class="code">set VarName=Value</span> 
		where <span class="code">VarName</span> is a name of the environment variable and 
		<span class="code">Value</span> is a string to be assigned to the specified variable. The good 
		practice is to store such commands in a batch script before udefrag.exe calls. That will save 
		a lot of your time. This practice will be discussed below. Here is a list of defragmentation 
		related environment variables with a full explaination:
		</p>
		<table border="1" cellpadding="5" style="padding: 0px"><tbody>

		<tr>
		<td class="code" align="center">UD_IN_FILTER</td>
		<td>
		List of files to be included in defragmentation process. File names must be separated by 
		semicolon. Most useful example is: <span class="code">set UD_IN_FILTER=My Documents</span>. 
		After this assignment the defragger will process <span class="code">My Documents</span> 
		directory contents only.<br />
		The default value is an empty string that means: all files will be included.
		</td>
		</tr>

		<tr>
		<td class="code" align="center">UD_EX_FILTER</td>
		<td>
		List of files to be excluded from defragmentation process. 
		File names must be separated by semicolon. Most useful example is:
		<span class="code">set UD_EX_FILTER=system volume information;temp;recycler</span>. 
		After this assignment many temporary files will be excluded from the 
		defragmentation process.<br />
		The default value is an empty string. It means: no files will be excluded.
		</td>
		</tr>

		<tr>
		<td class="code" align="center">UD_SIZELIMIT</td>
		<td>
		Ignore files larger than specified value. You can either specify size in bytes 
		or use the following suffixes: <span class="code">Kb, Mb, Gb, Tb, Pb, Eb</span>. <br />
		P.a., use <span class="code">set UD_SIZELIMIT=10Mb</span> to exclude all files 
		greater than 10 megabytes.
		<br />The default value is zero. It means: there is no size limit.
		</td>
		</tr>

		<tr>
		<td class="code" align="center">UD_REFRESH_INTERVAL</td>
		<td>
		Specify the progress indicator refresh interval in milliseconds.
		<br />The default value is <span class="code">500</span>.
		</td>
		</tr>

		<tr>
		<td class="code" align="center">UD_DISABLE_REPORTS</td>
		<td>
		Set this parameter to <span class="code">1</span> (one) to disable reports generation.
		<br />The default value is <span class="code">0</span>.
		</td>
		</tr>

		<tr>
		<td class="code" align="center">UD_DBGPRINT_LEVEL</td>
		<td>
		This parameter can be in one of three states. Set 
		<span class="code">UD_DBGPRINT_LEVEL=NORMAL</span> to view useful messages about 
		the analyse or defrag progress. Select <span class="code">DETAILED</span> to create 
		a bug report to send to the author when an error is encountered. Select 
		<span class="code">PARANOID</span> in extraordinary cases. Of course, you need have DbgView 
		program or DbgPrint Logger installed to view logs.
		<br />The default value is <span class="code">NORMAL</span>.
		</td>
		</tr>

		</tbody></table>

		<p>Notes about filter:
		<ul type="disc">
		<li>Enter multiple filter match strings separated by the semicolon (;) character.</li>
		<li>The filter is case insensitive.</li>
		<li>The patterns you supply for the include and exclude functionality 
		applies to the whole path. For example, if you specify <span class="code">UD_EX_FILTER=temp</span> 
		you would exclude both the temp folder (<span class="code">%windir%\temp</span>) and 
		the internet explorer temporary files folder.</li>
		<li>Filter strings cannot be longer than 4096 characters.</li>
		</ul>
		</p>

	</div>

	<div class="sect1" lang="en">
		<div class="titlepage">
			<div><div>
				<h2 class="title" style="clear: both"><a name="ctxhandler"></a>
				Context menu handler</h2>
			</div></div>
		</div>
		<p>
		The console application is also used as a context menu handler. When you 
		right click drive/folder/file icon in Explorer you can select 
		<span class="guimenuitem">[--- Ultra Defragmenter --]</span> menu item to defragment 
		the selected object.
		</p>
		<p>To stop the defragmentation press Ctrl+C keys 4 times or close the console application 
		window.</p>
	</div>

	<div class="sect1" lang="en">
		<div class="titlepage">
			<div><div>
				<h2 class="title" style="clear: both"><a name="examples"></a>
				Example batch scripts</h2>
			</div></div>
		</div>
		<p>
		The best practice is to use the console application in batch scripts. You can define 
		all program's options there and defragment multiple volumes in series by typing a single command. 
		Here is the complete example. To try them store the code into <span class="code">ud-example.cmd</span> 
		file and click it's icon.
		</p>
<pre class="screen"><strong class="userinput"><code>@echo off

set UD_EX_FILTER=system volume information;temp;recycler
set UD_SIZELIMIT=50Mb
udefrag c: > c:\ud.log

set UD_IN_FILTER=My Documents
udefrag d: >> c:\ud.log

set UD_IN_FILTER=
udefrag e: >> c:\ud.log
</code></strong></pre>
		<p>The command <span class="code">set UD_IN_FILTER=</span> destroys the specified variable. The 
		appropriate option will have the default value after this command.</p>
		<p>
		Batch files are powerful enough, try to insert commands to play sounds after 
		each defragmentation. If you doubt that your volumes are in good state then add 
		<span class="code">chkdsk</span> command too. Also you can use 
		<span class="code">shutdown -s -t 00</span> command to halt your computer after 
		the defragmentation job. 
		</p>
	</div>
</div>

<div style="color: black; margin-top: 20px; margin-left: 20px; margin-right: 20px;">
	<div style="position: absolute; left: 20px;"><a accesskey="p" href="installation.html">Prev</a></div>

	<div style="position: absolute; right: 20px;"><a accesskey="n" href="gui.html">Next</a></div>

	<div align="center"><a accesskey="h" href="index.html">Home</a></div>
</div>

<div style="color: black; margin-left: 20px; margin-right: 20px;">
	<div class="navLeft">Installation&nbsp;</div>

	<div class="navRight">&nbsp;Graphical interface</div>

	<div class="navCenter"><a accesskey="u" href="index.html">Up</a></div>
</div>

<br />
<br />

<div class="bannerBottom" style="background-image: url(bottom-middle.png); width: 100%; height: 100px; bottom: 0px;">
	<div class="bannerBottomRight">
		<img src="bottom-right.png" style="margin: 0px;" alt="" />
	</div>
	<div class="bannerBottomLeft">
		<img src="bottom-left.png" style="margin: 0px;" alt="" />
		<a href="http://ultradefrag.sourceforge.net/" 
		style="position: absolute; left: 10px; background-color: transparent; color: #FFFFFF; font-weight: bold;">ultradefrag.sourceforge.net</a>
		<a href="http://sourceforge.net" 
		style="position: absolute; left: 10px; bottom: 35px; background-color: transparent; color: #FFFFFF; font-weight: bold;">
			<img src="http://sourceforge.net/sflogo.php?group_id=199532&amp;type=1" alt="SourceForge.net Homepage" border="0" height="31" width="88"  />
		</a>
	</div>
</div>

<!-- Piwik -->
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://apps.sourceforge.net/piwik/ultradefrag/" : "http://apps.sourceforge.net/piwik/ultradefrag/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
piwik_action_name = '';
piwik_idsite = 1;
piwik_url = pkBaseURL + "piwik.php";
piwik_log(piwik_action_name, piwik_idsite, piwik_url);
</script>
<object><noscript><p><img src="http://apps.sourceforge.net/piwik/ultradefrag/piwik.php?idsite=1" alt="piwik"/></p></noscript></object>
<!-- End Piwik Tag -->

</body>
</html>
