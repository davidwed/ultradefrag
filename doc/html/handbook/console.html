<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>Chapter 3. Console interface</title>
  <link rel="stylesheet" href="kde-default.css" type="text/css" />
  <link rel="stylesheet" href="udefrag.css" type="text/css" />
  <meta name="description" content="Ultra Defragmenter is a powerful Open Source defragmentation tool for Windows NT." />
  <meta name="keywords" content="UltraDefrag, Ultra Defragmenter, defragmentation, Open Source disk defragmenter, defragger, boot time defragmentation, boot time defragger, handbook, user manual, console interface" />
  <link rel="start" href="index.html" title="Ultra Defragmenter Handbook" />
  <link rel="prev" href="installation.html" title="Chapter 2. Installation" />
  <link rel="next" href="gui.html" title="Chapter 4. Graphical interface" />
</head>

<body bgcolor="white" text="black" alink="#0000ff" link="#0000ff" vlink="#840084">

<div style="background-image: url(top-middle.png); width: 100%; height: 131px;">
	<div style="position: absolute; right: 0px;">
		<img src="top-right-konqueror.png" style="margin: 0px;" alt="" />
	</div>

	<div style="position: absolute; top: 25px; right: 100px; text-align: right; font-size: xx-large; font-weight: bold; text-shadow: #fff 0px 0px 5px; color: #444;">
	Console interface</div>
</div>

<div style="margin-top: 20px; background-color: white; color: black; margin-left: 20px; margin-right: 20px;">
	<div style="position: absolute; left: 20px;"><a accesskey="p" href="installation.html">Prev</a></div>

	<div style="position: absolute; right: 20px;"><a accesskey="n" href="gui.html">Next</a></div>

	<div class="navCenter">&nbsp;</div>
</div>

<div class="chapter" lang="en">
	<div class="titlepage">
		<div><div>
				<h2 class="title">Chapter 3. Console interface</h2>
		</div></div>
	</div>

	<div class="toc">
		<p><b>Table of Contents</b></p>
		<dl>
			<dt><span class="sect1"><a href="console.html#overview">Overview</a></span></dt>
			<dt><span class="sect1"><a href="console.html#switches">Command line switches</a></span></dt>
			<dt><span class="sect1"><a href="console.html#env">Accepted environment variables</a></span></dt>
			<dt><span class="sect1"><a href="console.html#ctxhandler">Context menu handler</a></span></dt>
			<dt><span class="sect1"><a href="console.html#examples">Example batch scripts</a></span></dt>
		</dl>
	</div>
	
	<div class="sect1" lang="en">
		<div class="titlepage">
			<div><div>
				<h2 class="title" style="clear: both"><a name="overview"></a>
				Overview</h2>
			</div></div>
		</div>
		<p>The console application is called <span class="code">udefrag.exe</span>. It
		is placed in <span class="code">system32</span> directory by the installer. Therefore you can
		call it from the command line or run box without specifying the full path. 
		The program accepts a lot of useful options: you can perform any disk defragmentation job 
		using this tool.
		</p>
	</div>

	<div class="sect1" lang="en">
		<div class="titlepage">
			<div><div>
				<h2 class="title" style="clear: both"><a name="switches"></a>
				Command line switches</h2>
			</div></div>
		</div>
		<p>Usage:<br /><br /> <span class="code">udefrag [command] [options] [volumeletter:]</span></p>

		<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#EEEED4"><tbody><tr><td>
			<table width="100%" border="1" cellpadding="0" bgcolor="#EEEED4"><tbody>
			<tr>
				<td colspan="2" bgcolor="#D3D4C5"><font size="+1">Commands</font></td>
			</tr>
			<tr>
				<td nowrap="nowrap" align="right" valign="top" bgcolor="#F4F4CC">-a, --analyze</td>
				<td>Analyze specified volume only.</td>
			</tr>
			<tr>
				<td nowrap="nowrap" align="right" valign="top" bgcolor="#F4F4CC">--defragment</td>
				<td>Defragment volume. This key is optional - if no command is specified 
				<span class="code">udefrag</span> will defragment volume.</td>
			</tr>
			<tr>
				<td nowrap="nowrap" align="right" valign="top" bgcolor="#F4F4CC">-o, --optimize</td>
				<td>Optimize volume space by moving all files to the begining of the drive.</td>
			</tr>
			<tr>
				<td nowrap="nowrap" align="right" valign="top" bgcolor="#F4F4CC">-l, --list-available-volumes</td>
				<td>List volumes available for defragmentation, except removable media. Each line of output 
				contains volume letter, type of file system, total size and percent of free space.</td>
			</tr>
			<tr>
				<td nowrap="nowrap" align="right" valign="top" bgcolor="#F4F4CC">-la, --list-available-volumes=all</td>
				<td>List all available volumes.</td>
			</tr>
			<tr>
				<td nowrap="nowrap" align="right" valign="top" bgcolor="#F4F4CC">-h, -?, --help</td>
				<td>Show help screen. Running <span class="code">udefrag</span> without arguments have the same effect.</td>
			</tr>
			<tr>
				<td colspan="2" bgcolor="#D3D4C5"><font size="+1">Options</font></td>
			</tr>
			<tr>
				<td nowrap="nowrap" align="right" valign="top" bgcolor="#F4F4CC">-b, --use-system-color-scheme</td>
				<td>Use system (usually black/white) scheme instead of green color.</td>
			</tr>
			<tr>
				<td nowrap="nowrap" align="right" valign="top" bgcolor="#F4F4CC">-p, --suppress-progress-indicator</td>
				<td>Hide progress indicator.</td>
			</tr>
			<tr>
				<td nowrap="nowrap" align="right" valign="top" bgcolor="#F4F4CC">-v, --show-volume-information</td>
				<td>Show volume information after a job.</td>
			</tr>
			<tr>
				<td nowrap="nowrap" align="right" valign="top" bgcolor="#F4F4CC">-m, --show-cluster-map</td>
				<td>Show map representing clusters on specified volume.</td>
			</tr>
			<tr>
				<td nowrap="nowrap" align="right" valign="top" bgcolor="#F4F4CC">--map-border-color=color</td>
				<td>Specify cluster map border color. Available values: black, white, red, green, blue, 
				yellow, magenta, cyan, darkred, darkgreen, darkblue, darkyellow, darkmagenta, darkcyan, 
				gray. Yellow color is used by default.</td>
			</tr>
			<tr>
				<td nowrap="nowrap" align="right" valign="top" bgcolor="#F4F4CC">--map-symbol=x</td>
				<td>You can specify map symbol here. There are two supported formats: you can
                type symbol directly or specify its number in hexadecimal form. Like this: 
				--map-symbol=0x1 :-) Valid numbers are in range: 0x1 - 0xFF '%' symbol is used by default.
				</td>
			</tr>
			<tr>
				<td nowrap="nowrap" align="right" valign="top" bgcolor="#F4F4CC">--map-rows=n</td>
				<td>Number of rows in cluster map. Default value is 10.</td>
			</tr>
			<tr>
				<td nowrap="nowrap" align="right" valign="top" bgcolor="#F4F4CC">--map-symbols-per-line=n</td>
				<td>Number of map symbols containing in each row of map. Default value is 68.</td>
			</tr>
			</tbody></table>
		</td></tr></tbody></table>

		<p>Specifying just the drive letter will cause <span class="application">UltraDefrag</span>
		to defragment the drive. If you abort the operation with Ctrl+C or close the shell window, 
		<span class="application">UltraDefrag</span> will exit safely without destroying any data.</p>
	</div>

	<div class="sect1" lang="en">
		<div class="titlepage">
			<div><div>
				<h2 class="title" style="clear: both"><a name="screenshots"></a>
				Examples</h2>
			</div></div>
		</div>
		
		<center>

		I. Console application after a successful analyze run:
		
<pre width="70pt" style="border: 2px solid; background-color: black; font-size: 11pt;">
<div align="center" style="background-color: blue; color: white">Command prompt</div><div align="left" style="color: white">
Microsoft Windows XP [5.1.2600]
(C) Microsoft Corporation, 1985-2001.

C:\>udefrag -a c:</div><div align="left" style="color: #00FF00">UltraDefrag v3.2.0, Copyright (c) Dmitri Arkhangelski, 2007-2009.
UltraDefrag comes with ABSOLUTELY NO WARRANTY. This is free software,
and you are welcome to redistribute it under certain conditions.

c: analyse:  100% complete, fragmented/total = 916/16298
</div><div align="left" style="color: white">
C:\>_
</div>
</pre>
		
		II. <span class="code">udefrag -l</span> command in action:<br />

<pre width="70pt" style="border: 2px solid; background-color: black; font-size: 11pt;">
<div align="center" style="background-color: blue; color: white">Command prompt</div><div align="left" style="color: white">
Microsoft Windows XP [5.1.2600]
(C) Microsoft Corporation, 1985-2001.

C:\>udefrag -l</div><div align="left" style="color: #00FF00">UltraDefrag v3.2.0, Copyright (c) Dmitri Arkhangelski, 2007-2009.
UltraDefrag comes with ABSOLUTELY NO WARRANTY. This is free software,
and you are welcome to redistribute it under certain conditions.</div><div align="left" style="color: #FFFF00">
Volumes available for defragmentation:

C:      NTFS      3.92 Gb        6 %
D:      NTFS      9.42 Gb        3 %
E:     FAT32     59.30 Gb        5 %
</div><div align="left" style="color: white">
C:\>_
</div>
</pre>

		III. Cluster map customization example:<br /><br />
		<img src="console_map1.png" alt="" />
		
		</center>
		
		<p>Note that files excluded by filters are treated here always as unfragmented. Because 
		trash is unimportant anyway and it should not take an attention.</p>

	</div>

	<div class="sect1" lang="en">
		<div class="titlepage">
			<div><div>
				<h2 class="title" style="clear: both"><a name="env"></a>
				Accepted environment variables</h2>
			</div></div>
		</div>
		<p>To set defragmenter options you should use the 
		<a href="http://en.wikipedia.org/wiki/Environment_variable">Environment Variables</a>. 
		To set each of them you can simply type in command line <span class="code">set VarName=Value</span> 
		where <span class="code">VarName</span> is a name of the environment variable and 
		<span class="code">Value</span> is a string to be assigned to the specified variable. The good 
		practice is to store such commands in a batch script before udefrag.exe calls. That will save 
		a lot of your time. This practice will be discussed below. Here is a list of defragmentation 
		related environment variables with a full explaination:
		</p>

		<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#EEEED4"><tbody><tr><td>
			<table width="100%" border="1" cellpadding="0" bgcolor="#EEEED4"><tbody>
			<!--<table border="1" cellpadding="5" style="padding: 0px"><tbody>-->

			<tr>
				<td colspan="2" bgcolor="#D3D4C5"><font size="+1">Environment variables</font></td>
			</tr>

		<tr>
		<td class="code" align="center">UD_IN_FILTER</td>
		<td>
		List of files to be included in defragmentation process. File names must be separated by 
		semicolon. Like this: <span class="code">set UD_IN_FILTER=My Documents</span>. 
		After this assignment the defragger will process <span class="code">My Documents</span> 
		directory contents only. The default value is an empty string that means: all files will be included.
		</td>
		</tr>

		<tr>
		<td class="code" align="center">UD_EX_FILTER</td>
		<td>
		List of files to be excluded from defragmentation process. 
		File names must be separated by semicolon. Like this:
		<span class="code">set UD_EX_FILTER=system volume information;temp;recycler</span>. 
		After this assignment many temporary files will be excluded from the 
		defragmentation process. The default value is an empty string. It means: no files will be excluded.
		</td>
		</tr>

		<tr>
		<td class="code" align="center">UD_SIZELIMIT</td>
		<td>
		Ignore files larger than specified value. You can either specify size in bytes 
		or use the following suffixes: <span class="code">Kb, Mb, Gb, Tb, Pb, Eb</span>. 
		P.a., use <span class="code">set UD_SIZELIMIT=10Mb</span> to exclude all files 
		greater than 10 megabytes. The default value is zero. It means: there is no size limit.
		</td>
		</tr>

		<tr>
		<td class="code" align="center">UD_FRAGMENTS_THRESHOLD</td>
		<td>
		Ignore files that have less number of fragments than specified by this parameter.
		The default value is zero. It means: there is no fragments threshold.
		</td>
		</tr>

		<tr>
		<td class="code" align="center">UD_TIME_LIMIT</td>
		<td>
		Specify the time limit for the defragmentation process. When specified interval 
		elapses volume defragmentation/optimization job will be stopped. 
		Time interval must be specified in the following form: <span class="code">Ay Bd Ch Dm Es</span>. Here 
		<span class="code">A,B,C,D,E </span> represents any integer numbers; <span class="code">y,d,h,m,s</span> 
		suffixes are used for years, days, hours, minutes and seconds. Par example, 20 minutes 5 seconds will 
		be represented as <span class="code">20m 5s</span>. The default value is an empty string which means: no time limit exists.
		</td>
		</tr>

		<tr>
		<td class="code" align="center">UD_REFRESH_INTERVAL</td>
		<td>
		Specify the progress indicator refresh interval in milliseconds. 
		The default value is <span class="code">500</span>.
		</td>
		</tr>

		<tr>
		<td class="code" align="center">UD_DISABLE_REPORTS</td>
		<td>
		Set this parameter to <span class="code">1</span> (one) to disable reports generation. 
		The default value is <span class="code">0</span>.
		</td>
		</tr>

		<tr>
		<td class="code" align="center">UD_DBGPRINT_LEVEL</td>
		<td>
		This parameter can be in one of three states. Set 
		<span class="code">UD_DBGPRINT_LEVEL=NORMAL</span> to view useful messages about 
		the analyse or defrag progress. Select <span class="code">DETAILED</span> to create 
		a bug report to send to the author when an error is encountered. Select 
		<span class="code">PARANOID</span> in extraordinary cases. Of course, you need have DbgView 
		program or DbgPrint Logger installed to view logs. The default value is <span class="code">NORMAL</span>.
		</td>
		</tr>

		</tbody></table>
		</td></tr></tbody></table>

		<p>Notes about filter:
		<ul type="disc">
		<li>Enter multiple filter match strings separated by the semicolon (;) character.</li>
		<li>The filter is case insensitive.</li>
		<li>The patterns you supply for the include and exclude functionality 
		applies to the whole path. For example, if you specify <span class="code">UD_EX_FILTER=temp</span> 
		you would exclude both the temp folder (<span class="code">%windir%\temp</span>) and 
		the internet explorer temporary files folder.</li>
		<li>Filter strings cannot be longer than 4096 characters.</li>
		</ul>
		</p>

	</div>

	<div class="sect1" lang="en">
		<div class="titlepage">
			<div><div>
				<h2 class="title" style="clear: both"><a name="ctxhandler"></a>
				Context menu handler</h2>
			</div></div>
		</div>
		<p>
		The console application is also used as a context menu handler. When you 
		right click drive/folder/file icon in Explorer you can select 
		<span class="guimenuitem">[--- Ultra Defragmenter --]</span> menu item to defragment 
		the selected object.
		</p>
		<p>To stop the defragmentation press Ctrl+C keys 4 times or close the console application 
		window.</p>
		
		<p style="color: darkred;">Currently this feature is not available in portable version 
		of the program.</p>
	</div>

	<div class="sect1" lang="en">
		<div class="titlepage">
			<div><div>
				<h2 class="title" style="clear: both"><a name="examples"></a>
				Example batch scripts</h2>
			</div></div>
		</div>
		<p>
		The best practice is to use the console application in batch scripts. You can define 
		all program's options there and defragment multiple volumes in series by typing a single command. 
		Here is the complete example. To try them store the code into <span class="code">ud-example.cmd</span> 
		file and click it's icon.
		</p>
<pre class="screen"><strong class="userinput"><code>@echo off

set UD_EX_FILTER=system volume information;temp;recycler;.zip;.7z;.rar
set UD_SIZELIMIT=50Mb
udefrag c: > c:\ud.log

set UD_IN_FILTER=My Documents
udefrag d: >> c:\ud.log

set UD_IN_FILTER=
udefrag e: >> c:\ud.log
</code></strong></pre>
		<p>The command <span class="code">set UD_IN_FILTER=</span> destroys the specified variable. The 
		appropriate option will have default value after this command.</p>
		
		<p>Note that archives are excluded from the defragmentation in script above. This is 
		because archives are usually rarely accessed, therefore may be leaved fragmented without 
		noticeable performance degradation.</p>
		
		<p>The following example demonstrates flexibility of filters which 
		allow you to perform a very effective defragmentation:</p>
		
<pre class="screen"><strong class="userinput"><code>@echo off

rem defragment small files
set UD_SIZELIMIT=50Mb
udefrag c:

rem defragment large files 
rem which have at least 5 fragments
set UD_SIZELIMIT=
set UD_FRAGMENTS_THRESHOLD=5
udefrag c:
</code></strong></pre>

		<p>
		Batch files are powerful enough, try to insert commands to play sounds after 
		each defragmentation. If you doubt that your volumes are in good state then add 
		<span class="code">chkdsk</span> command too. Also you can use 
		<span class="code">shutdown -s -t 00</span> command to halt your computer after 
		the defragmentation job. 
		</p>
		<p>To hibernate your PC use <span class="code">hibernate4win now</span> command. An appropriate 
		tool is included in UltraDefrag package; it installs by default to your system32 directory.
		</p>
		<p>The <a href="nextgen.html">UltraDefrag Next Generation</a> GUI was built especially 
		to show simplicity and power of batch scripts.</p>
	</div>
</div>

<div style="color: black; margin-top: 20px; margin-left: 20px; margin-right: 20px;">
	<div style="position: absolute; left: 20px;"><a accesskey="p" href="installation.html">Prev</a></div>

	<div style="position: absolute; right: 20px;"><a accesskey="n" href="gui.html">Next</a></div>

	<div align="center"><a accesskey="h" href="index.html">Home</a></div>
</div>

<div style="color: black; margin-left: 20px; margin-right: 20px;">
	<div class="navLeft">Installation&nbsp;</div>

	<div class="navRight">&nbsp;Graphical interface</div>

	<div class="navCenter"><a accesskey="u" href="index.html">Up</a></div>
</div>

<br />
<br />

<div class="bannerBottom" style="background-image: url(bottom-middle.png); width: 100%; height: 100px; bottom: 0px;">
	<div class="bannerBottomRight">
		<img src="bottom-right.png" style="margin: 0px;" alt="" />
	</div>
	<div class="bannerBottomLeft">
		<img src="bottom-left.png" style="margin: 0px;" alt="" />
	</div>
	<div class="bannerBottomLeft">
		<a href="http://ultradefrag.sourceforge.net/" style="position: absolute; left: 10px;">
		  <img src="udefrag124x31.gif" alt="ultradefrag.sourceforge.net" border="0" width="124" height="31" />
		</a>
		<a href="http://sourceforge.net/projects/ultradefrag" style="position: absolute; left: 134px;">
		  <img src="http://sflogo.sourceforge.net/sflogo.php?group_id=199532&amp;type=11" alt="" border="0" height="30" width="120"  />
		</a>
	</div>
</div>

<!-- Piwik -->
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://apps.sourceforge.net/piwik/ultradefrag/" : "http://apps.sourceforge.net/piwik/ultradefrag/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
piwik_action_name = '';
piwik_idsite = 1;
piwik_url = pkBaseURL + "piwik.php";
piwik_log(piwik_action_name, piwik_idsite, piwik_url);
</script>
<object><noscript><p><img src="http://apps.sourceforge.net/piwik/ultradefrag/piwik.php?idsite=1" alt="piwik"/></p></noscript></object>
<!-- End Piwik Tag -->

</body>
</html>
