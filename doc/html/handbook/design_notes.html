<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  <title>Design Notes</title>
  <link rel="stylesheet" href="kde-default.css" type="text/css" />
  <link rel="stylesheet" href="udefrag.css" type="text/css" />
  <meta name="description" content="Ultra Defragmenter is a powerful Open Source defragmentation tool for Windows NT." />
  <meta name="keywords" content="UltraDefrag, Ultra Defragmenter, defragmentation, Open Source disk defragmenter, defragger, boot time defragmentation, boot time defragger, handbook, user manual, design notes" />
  <link rel="start" href="index.html" title="Ultra Defragmenter Handbook" />
  <link rel="prev" href="development.html" title="Appendix A. Development" />
  <link rel="next" href="i18n.html" title="Translation" />
</head>

<body bgcolor="white" text="black" alink="#0000ff" link="#0000ff" vlink="#840084">

<div style="background-image: url(top-middle.png); width: 100%; height: 131px;">
	<div style="position: absolute; right: 0px;">
		<img src="top-right-konqueror.png" style="margin: 0px;" alt="" />
	</div>

	<div style="position: absolute; top: 25px; right: 100px; text-align: right; font-size: xx-large; font-weight: bold; text-shadow: #fff 0px 0px 5px; color: #444;">
	Design Notes</div>
</div>

<div style="margin-top: 20px; background-color: white; color: black; margin-left: 20px; margin-right: 20px;">
	<div style="position: absolute; left: 20px;"><a accesskey="p" href="development.html">Prev</a></div>

	<div style="position: absolute; right: 20px;"><a accesskey="n" href="i18n.html">Next</a></div>

	<div class="navCenter">&nbsp;</div>
</div>

<div class="chapter" lang="en">
	<div class="titlepage">
		<div><div>
				<h2 class="title">Design Notes</h2>
		</div></div>
	</div>

	<div class="sect1" lang="en">
		<p>The Ultra Defragmenter contains few modules that are separated to five levels 
		as shown on a picture below.</p>
		<center><img src="udscheme.png" border="0" alt="Application Scheme" /></center>
		<p>At the bottom level we have the kernel mode driver named ultradfg.sys. As described in
		this handbook this is the best solution for the disk 
		defragmentation software. Driver gives us an interesting features and advantages 
		over other defraggers.
		</p>
		<p>The second level contains two different dynamically linked libraries.
		</p>
		<p>ZenWINX is a common set of functions that most programs needs. Boot time defragger 
		can't use win32 environment, it should use only ntdll.dll, but this library doesn't 
		contain many important things like keyboard related procedures (gets, getch, kbhit), 
		printf implementation and others. ZenWINX was created to resolve this problem. 
		The full documentation for ZenWINX library is <a href="http://zenwinx.sourceforge.net">here</a>.
		</p>
		<p>On the other hand, the udefrag.dll library is just a thin level between the driver and
		user interfaces. It provides more simpler API than driver has. This module can import 
		symbols from ntdll.dll (and other native dll's like zenwinx) only, because it is used 
		by native (boot time) application.
		</p>
		<p>Over the described modules are user interfaces located. They are well documented in 
		this hanbook. I wrote them in pure C language because I would like to run UltraDefrag on 
		old machines without any additional packages installed. Windows distribution doesn't 
		contain any modern scripting languages packages (Python, Perl etc.), so C is better 
		choice here.
		</p>
		<p>As you can see, gui application uses some external software. The report converter
		produces html reports from a simple text file generated by driver. This converter is written 
		in Lua, because this language has much better support for string manipulations than C or 
		C++ have, and it's a very small package that can be included in UltraDefrag binaries 
		without any problems.
		</p>
		<p>Other programs that are used by gui are a text editor (that must have Unicode support) 
		and a web browser. The first is needed to edit program's settings. It's better to use an 
		external text editor than write a specialized one. Less code we have less bugs we have.
		Web browser is a good program to display file fragmentation reports.
		</p>
		<p>The highest level of the Ultra Defragmenter I wrote in JavaScript language, because it 
		is very simple, can be embedded in web pages and has good (though primitive enough) 
		support for strings processing.
		</p>
		<p>Also UltraDefrag uses two libraries to simplify GUI development. First is Lua library, 
		it simplifies settings reading from text files. Second is WGX (Windows GUI Extended) 
		library made especially for UltraDefrag. It highly simplifies GUI development, because 
		contains a set of very useful functions that can be used in any GUI application. 
		UltraDefrag's i18n support is powered by WGX.
		</p>
		<p>Since version 3.1.0 UltraDefrag contains the Configurator program - a graphical interface 
		to all program's configuration files. This application utilize functions from Lua and WGX 
		libraries, but not from udefrag.dll.
		</p>
		<p>Of course, we have not discussed yet our installer and scheduler. NSIS gives us an 
		ability to have both installer and portable package in the same file. This language is 
		very powerful and we don't need to use something else at this moment.
		</p>
		<p>Scheduler is an additional application that is much easier to use than built-in task
		scheduler interface. It requires .NET Framework installed because C# is a good choice to 
		implement this component. Task scheduler API is too complicated to use them in C.
		Though, if you wish, rewrite the scheduler in C or maybe in Assembler.
		</p>
		<p>I don't plan to write some additional interfaces, p.a. one with skins, another 
		implemented in popular Python language and so on. But if you would like to have 
		experiments in this area you are welcome!
		</p>
	</div>
</div>

<div style="color: black; margin-top: 20px; margin-left: 20px; margin-right: 20px;">
	<div style="position: absolute; left: 20px;"><a accesskey="p" href="development.html">Prev</a></div>

	<div style="position: absolute; right: 20px;"><a accesskey="n" href="i18n.html">Next</a></div>

	<div align="center"><a accesskey="h" href="index.html">Home</a></div>
</div>

<div style="color: black; margin-left: 20px; margin-right: 20px;">
	<div class="navLeft">Compilation&nbsp;</div>

	<div class="navRight">&nbsp;Translation</div>

	<div class="navCenter"><a accesskey="u" href="index.html">Up</a></div>
</div>

<br />
<br />

<div class="bannerBottom" style="background-image: url(bottom-middle.png); width: 100%; height: 100px; bottom: 0px;">
	<div class="bannerBottomRight">
		<img src="bottom-right.png" style="margin: 0px;" alt="" />
	</div>
	<div class="bannerBottomLeft">
		<img src="bottom-left.png" style="margin: 0px;" alt="" />
	</div>
	<div class="bannerBottomLeft">
		<a href="http://ultradefrag.sourceforge.net/" style="position: absolute; left: 10px;">
		  <img src="udefrag124x31.gif" alt="ultradefrag.sourceforge.net" border="0" width="124" height="31" />
		</a>
		<a href="http://sourceforge.net/projects/ultradefrag" style="position: absolute; left: 134px;">
		  <img src="http://sflogo.sourceforge.net/sflogo.php?group_id=199532&amp;type=11" alt="" border="0" height="30" width="120"  />
		</a>
	</div>
</div>

<!-- Piwik -->
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://apps.sourceforge.net/piwik/ultradefrag/" : "http://apps.sourceforge.net/piwik/ultradefrag/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
piwik_action_name = '';
piwik_idsite = 1;
piwik_url = pkBaseURL + "piwik.php";
piwik_log(piwik_action_name, piwik_idsite, piwik_url);
</script>
<object><noscript><p><img src="http://apps.sourceforge.net/piwik/ultradefrag/piwik.php?idsite=1" alt="piwik"/></p></noscript></object>
<!-- End Piwik Tag -->

</body>
</html>
