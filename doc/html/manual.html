<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
<meta http-equiv="CONTENT-TYPE" content="text/html; charset=us-ascii">
<title>UltraDefrag User Manual</title>

<meta name="GENERATOR" content="OpenOffice.org 2.1 (Win32)">
<meta name="CREATED" content="20070808;19191900">
<meta name="CHANGEDBY" content="Dmitri Arkhangelski">
<meta name="CHANGED" content="20070905;22040900">
<style type="text/css">
<!--
@page { size: 21.59cm 27.94cm; margin: 2cm }
P { margin-bottom: 0.21cm }
H1 { margin-bottom: 0.21cm }
H1.western { font-family: "Arial", sans-serif; font-size: 16pt }
H1.cjk { font-family: "Arial Unicode MS"; font-size: 16pt }
H1.ctl { font-family: "Tahoma"; font-size: 16pt }
H2 { margin-bottom: 0.21cm }
H2.western { font-family: "Arial", sans-serif; font-size: 14pt; font-style: italic }
H2.cjk { font-size: 14pt; font-style: italic }
H2.ctl { font-size: 14pt; font-style: italic }
H3 { margin-bottom: 0.21cm }
H3.western { font-family: "Arial", sans-serif }
-->
</style>
</head>
<body style="direction: ltr; color: rgb(0, 0, 0); background-color: rgb(240, 240, 255); font-family: Times New Roman; font-size: 12pt;" alink="#ff0000" lang="en-US" vlink="#660099">
<h1 class="western" style="" align="center"><font style="font-size: 20pt;" size="5">UltraDefrag
User Manual</font></h1>
<h1 class="western" style="" align="right"><i>Written
by <a href="mailto:zippy1981 + at + gmail + dot + com">Justin Dearing</a></i></h1>
<h1 class="western">What is UltraDefrag?</h1>
<p>UltraDefrag is an open source disk defragmenter for Windows NT 4.0
and later operating systems. It makes use of the same defragmenting
API used by many other windows defrag utilities, both open and closed
source. However, UltraDefrag has two features that make it unique.
The first is that it has a kernel mode driver that does most of the
work. The second is the ability to run the application at boot up
time in a manner similar to chkdsk. This allows for faster
defragmentation time and the ability to defragment all files
including system files.</p>
<p>UltraDefrag supports the following filesystems FAT12/16/32, NTFS and on
Vista UDF. UDF is a file system intended for optical media such as DVDs that
unlike ISO9660, is rewriteable. It has also the ability to defragment volumes
at boot time allowing you to move many system files that are always locked by
the operating system. Currently all files besides the registry hives and
the pagefile can be scanned at boot time. UltraDefrag can also
defragment files and folders compressed by NTFS file system
compression. And can even defragment floppies, although doing so is
not particularly useful. </p>
<p>UltraDefrag binaries are available for the 32 bit and all 64 bit
versions of Windows.</p>
<h1 class="western">Installing UltraDefrag</h1>
<p>You can download the latest installer for UltraDefrag at the
project homepage 
(<a href="http://ultradefrag.sourceforge.net/">http://ultradefrag.sourceforge.net/</a>).
Simply download and run the installer. No reboot is required.</p>
<p>Note that you must be an administrator to install and run
UltraDefrag.</p>
<h1 class="western">Using UltraDefrag</h1>
<p><b>IMPORTANT</b><span style=""> You must disable your virus detection
software before using UltraDefrag.</span></p>
<h2 class="western">Console Application</h2>
<p>The console application is called udefrag.exe. It
is placed in system32 directory by the installer. Therefore you can
call it from the command line or run box.</p>
<h3 class="western">Usage</h3>
<h3 class="western"><img src="images/console.png" name="Frame1" alt="Console application" align="bottom"></h3>
<i>Console Application after a successful analyze run.</i>
<p>The command line version takes one of three switches and a
drive
letter. The switches are as follows:</p>
<ul>
<li>-? Displays the usage message</li>
<li>-a Analyze the drive specifued on the command line</li>
<li>-o Optomize file space by moving all files to the begining of the drive</li>
</ul>
<p>In addition the following switches can be used when defraging and compacting.
They override the settings in the registry set by the gui described below. The defaults
for the registry setting are set at compile time.</p>
<ul>
<li>-sN ignore files larger than N bytes</li>
<li>-iA;B;C Include these files and directories from the scan (Maximum 4096 bytes)</li>
<li>-eX;Y;Z Exclude these files and directories from the scan (Maximum 4096 bytes)</li>
<li>-d[0-3] Set debug level: 0 Normal, 1 Detailed, 2 Paranoid</li>
<li>-b Use default color scheme</li>
</ul>
<p>Specifying just the drive letter will cause UltraDefrag
to defragment the drive. When the operation finishes or you stop the
program with a Ctrl+C, the program will display the results to the
console. If you abort the operation with Ctrl+C or close the shell
window, UltraDefrag will exit safely without destroying any data.</p>
<h3 class="western">Windows Application</h3>
<p>The windows application is a simple application with one main
form of fixed size and an about box. An illustration of the window as well
as an explanation of their functionality is below:</p>
<p><img src="images/main_screen110.png" name="graphics1" alt="Main window" align="bottom" border="0"></p>
<ol>
<li>
<p><b>List of volumes.</b> This list all drives
on the machine that you can scan. It has the following fields:</p>
<ol>
<li>
<p><b>Volume</b> (Drive Letter)</p>
</li>
<li>
<p><b>Status</b> A description of the action
being performed (Analyze, defrag, etc).</p>
</li>
<li>
<p><b>File Sytem</b> type of file system
contained on the <span style="">volume.</span></p>
</li>
<li>
<p><b>Total Size</b></p>
</li>
<li>
<p><b>Free </b><span style="">Free
space</span></p>
</li>
<li>
<p><b>Percent</b> Percent Free.</p>
</li>
</ol>
</li>
<li>
<p><b>Skip Removeable Media Checkbox</b></p>
</li>
<li>
<p><b>Cluster Map</b><span style="">
This is a color coded representation of all drives. The </span><a href="#AboutBox%7Cgraphic"><span style="">about
box</span></a><span style=""> explains what
the colors represent.</span></p>
</li>
<li>
<p><b>Rescan <span style="font-style: normal;">Drives
(Ctrl+R) </span></b><span style="">This
button will recheck all volumes in the system to see if some were added
or removed.</span></p>
</li>
<li>
<p><b>Buttons</b><span style=""><br>
The following section explains the buttons along with listing their
shortcut keys.</span></p>
<ol>
<li>
<p><b>Analyze (Ctrl+A)</b><span style="">
Scans the currently selected drive to determine how fragmented it is.</span></p>
</li>
<li>
<p><b>Defrag (Ctrl+D)</b><span style="">
Exactly what it says.</span></p>
</li>
<li>
<p><b>Compact</b><span style="">
</span><b>(Ctrl+C) </b><span style="">Moves
all files to the beginning of the partition, defragmenting them if
possible. The compact command does not work on volumes with the FAT
filesystem because you cannot move directories on them.</span></p>
</li>
<li>
<p><b>Pause</b><span style=""> </span><b>(Ctrl+P)
</b><span style="">Stops the currently
running analyze or defrag operation. This behavior is the same as stop.</span></p>
</li>
<li>
<p><b>Stop</b><span style=""> </span><b>(Ctrl+S)
</b><span style="">Stop the currently
running analyze or defrag operation.</span></p>
</li>
<li>
<p><b>Fragmented</b><span style="">
</span><b>(Ctrl+F) </b><span style="">Display
a report of all fragmented files on the system. This report is very
small but useful. It is generated by the driver, so all versions of
UltraDefrag generate it.</span></p>
</li>
<li>
<p><b>Settings (Ctrl+T) </b>Displays the Settings Dialog. The settings dialog has
three tabs. These settings are stored in the registry and override the setting
hardcoded into the executable at compile time. The compile tome defaults are
set in "src\dll\udefrag\settings.c".</p>
<ol>
<li>
<p><b>Filter</b> You can specify file to include and exclude from the scan as well as
ignore files over a given size.</p>
<p>The patterns you supply for the include and exclude functionality
applies to the whole path. For example, if you specify temp\ in the
exclude path you would exclude both the temp folder (%WINDIR%\temp) and
the internet explorer temporary files folder. Filter strings cannnot be longer
than 4096 bytes.</p>
<p>You can specify maximum file size with the following suffixes (Kb | Mb
| Gb | Tb). </p>
</li>
<li>
<p><b>GUI</b><span style="">
You can toggle the progress bar and specify the interval to update the
map.</span></p>
</li>
<li>
<p><b>Report</b><span style="">
Specify the following settings for the report.</span></p>
<ol>
<li>
<p><b>Type</b><span style="">
html or none.</span></p>
</li>
<li>
<p><b>Encoding</b><span style="">
UTF-18 or ASCII. Generally ASCII renders better in Internet Explorer
and UTF-16 renders better in FireFox. UTF-16 is of course required to
properly render Asian characters such as Japanese and Chinese.</span></p>
</li>
<li>
<p><b>Debug Print</b><span style="">
Normal or Detailed. Select normal to view useful messages about the
analyse or defrag progress. Select detailed to create a bug report to
send to the author when an error is encountered.</span></p>
</li>
</ol>
</li>
<li>
<p><b>Boot time</b><span style="">
Settings releated to the boot time scan with the native executable.</span></p>
<ol>
<li>
<p><b>Drive letters</b><span style=""> The drives to scan. Letters must be either 
separated by semicolons (;) or don't contain any separators between.</span></p>
</li>
<li>
<p><b>Defragment at next boot </b><span style="">and</span><b> Defragment every boot</b><span style=""> Check these boxes to chose when to defragment.</span></p>
</li>
<li>
<p><b>Include</b><span style="">
and </span><b>Exclude</b><span style="">
file filters. These operate the same as the ones in the filter dialog.</span></p>
</li>
</ol>
</li>
</ol>
</li>
<li>
<p><b>About (F1)</b><span style="">
Displays the about box shown below. <br>
Included in the about box is a legend of the color codes found on the
cluster map. Some of the categories on the legend have a lighter and
darker color on them. The lighter colors represent files below the file
size threshold, and the darker colors represent files above the
threshold if one is set.<br>
<a name="AboutBox|graphic"></a><img src="images/about.png" name="AboutBox" alt="About box" border="0"></span></p>
</li>
</ol>
</li>
<li>
<p><b>Progress bar</b><span style="">
This displays the progress of the currently running analyze, compact or
defrag task. Note that selecting a different volume will cause this bar
to disappear.</span></p>
</li>
</ol>
<h2 class="western" style="">Boot time scan</h2>
<p style="">UltraDefrag also includes a new mode
that allows you to run it at boot time in a manner similar to chkdsk.
This is known as a native application.</p>
<p>Boot time settings may be specified in the gui. You may schedule a boot
time scan for the next reboot, or at every reboot. The only restriction on
boot time scans is that you may not scan encrypted volumes. This is because
lsass.exe, the component of the operating system that reads encrypted volumes,
is loaded after the native executable runs.</p>
<h1 class="western">The Report</h1>
<p>Everytime you run analyze, compact or defragment, a report of
all files on the file system is created. This report has the
following fields.</p>
<ol>
<li>
<p><b>Number of fragments.</b></p>
</li>
<li>
<p><b>Filename</b></p>
</li>
<li>
<p><b>Comment</b><span style="">
This can be blank or contain one of three values:</span></p>
<ol>
<li>
<p><b>[OVR]</b><span style="">
File is over limit.</span></p>
</li>
<li>
<p><b>[DIR]</b><span style="">
Object is a directory.</span></p>
</li>
<li>
<p><b>[CMP]</b><span style="">
Compressed file.</span></p>
</li>
</ol>
</li>
</ol>
<h1 class="western">Scheduling Defrag runs.</h1>
<p>The command line version of UltraDefrag may be run out of system
scheduled tasks, The process of adding a scheduled task instance of
UltraDefrag is simplified throuth a utility called UltraDefrag
Scheduler.NET. This small application requites Microsoft Framework 2.0to run. The simple gui has 4 settings. </p>
<p><img style="width: 248px; height: 157px;" alt="UltraDefrag Scheduler.NET" src="images/sched_net_vista.png"></p>
<ol><li>Whether to run Ultra Defrag every day (Daily) or only certain days of the week (Weekly).</li><li>The time of day to run the task.</li><li>The drive letter to scan.</li><li>Days of the week to defrag if Weekly is selected.</li></ol>
<h1 class="western">How it works</h1>
<p>The actual work of moving files to different clusters is
performed
through the windows API. What makes UltraDefrag superior to the
standard windows defrag utility is that it uses its own algorithm to
determine where to place files. Also, the actual work is done by the
kernel driver ultradfg.sys. This enhances performance because there
is no constant switching between user mode and kernel mode.</p>
<h1 class="western">Getting the Source</h1>
<p>Source for UltraDefrag is available via subversion. The url is
<a href="https://ultradefrag.svn.sourceforge.net/svnroot/">https://ultradefrag.svn.sourceforge.net/svnroot/</a>.
The program is written in C. The code is very clear and
understandable. To build it you will need a C compiler and the
Windows Driver Development Kit (DDK).</p>
<h1 class="western">Reporting Bugs</h1>
<p class="western">Please report all problems and bugs via
the
<a href="http://sourceforge.net/tracker/?atid=969870&amp;group_id=199532&amp;func=browse">
sourceforge bug tracker</a>.</p>
<p><b>NOTE:</b> Please include the following data in
your bug report:</p>
<ol>
<li>If you see a 'Blue Screen Of Death' when running
UltraDefrag then include the important parts of the message.</li>
<li>For gui releated bugs, please attach a screenshot</li>
<li>If the bug is not gui related, please follow <a href="manual_debugging.html">these directions</a> to get the debuging information.</li>
</ol>
<h1 class="western">See Also</h1>
<ul>
<li>
<p><a href="http://ultradefrag.sourceforge.net/">UltraDefrag
Homepage</a></p>
</li>
<li>
<p><a href="http://en.wikipedia.org/wiki/Defragmentation">Wikipedia
article on Defragmentation</a></p>
</li>
<li>
<p><a href="http://www.microsoft.com/whdc/DevTools/ddk/default.mspx">Windows
Driver Development Kit (DDK)</a></p>
</li>
<li>
<p><a href="http://www.microsoft.com/technet/sysinternals/information/NativeApplications.mspx">Sysinternals
Article on Native Executables</a></p>
</li>
</ul>
<hr>
<div align="right">
<table align="right">
<tbody>
<tr align="right">
<td><a href="http://www.lua.org/"><img src="images/powered_by_lua.png" alt="Powered by Lua" border="0" height="31" width="124"></a></td>
<td><a href="http://validator.w3.org/check?uri=referer"><img src="images/valid-html401.png" alt="Valid HTML 4.01 Transitional" border="0" height="31" width="88"></a></td>
<td><a href="http://sourceforge.net"> <img src="http://sourceforge.net/sflogo.php?group_id=199532&amp;type=1" alt="SourceForge.net Logo" border="0" height="31" width="88"></a> </td>
</tr>
</tbody>
</table>
</div>
<br>
<br>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-2897964-4");
pageTracker._initData();
pageTracker._trackPageview();
</script>
</body></html>
